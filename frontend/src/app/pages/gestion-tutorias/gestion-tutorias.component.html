<app-page-breadcrumb pageTitle="Gestión Tutorías" />

<div class="p-4 rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
  <div>
    <div class="p-4 sm:p-6">
      <div class="space-y-3">

        <div class="flex items-end gap-4">
          <div class="flex-1">
            <app-label>Periodo</app-label>
            <app-select
              [options]="options"
              placeholder="Selecciona un periodo"
              [value]="selectedValue"
              (valueChange)="handleSelectChange($event)"
              className="dark:bg-dark-900"
            ></app-select>
          </div>

          <app-button size="sm" variant="outline" (click)="agregarTutoria()">
            Agregar Tutoria
          </app-button>
        </div>

      </div>
    </div>

    <div class="mt-6 overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03]">
      <div class="max-w-full overflow-x-auto">
        <table class="min-w-full">
          <!-- Table Header -->
          <thead class="border-b border-gray-100 dark:border-white/[0.05]">
            <tr>
              <th class="px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400">#</th>
              <th class="px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400">ID</th>
              <th class="px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400">Carreras</th>
              <th class="px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400">N° Tutores</th>
              <th class="px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400">Fecha de creación</th>
              <th class="px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400">Acción</th>
            </tr>
          </thead>

          <!-- Table Body -->
          <tbody class="divide-y divide-gray-100 dark:divide-white/[0.05]">
            @if (tableData.length > 0) {
              @for (info of tableData; track $index; let i = $index) {
                <tr>
                  <td class="px-5 py-4 sm:px-6 text-start text-gray-500 text-theme-sm dark:text-gray-400">
                    {{ i + 1 }}
                  </td>
                  <td class="px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400">
                    {{ info.carreraIds?.join(', ') }}
                  </td>
                  <td class="px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400">
                    {{ info.carreras }}
                  </td>
                  <td class="px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400">
                    {{ info.n_tutores }}
                  </td>
                  <td class="px-4 py-3 text-gray-500 text-theme-sm dark:text-gray-400">
                    {{ info.fecha_creacion }}
                  </td>
                  <td class="px-4 py-3 text-gray-500 text-theme-sm dark:text-gray-400">
                    <div class="flex items-center gap-4">
                      <button
                        class="text-blue-600 hover:text-blue-800 transition"
                        (click)="editarTutoria(info)"
                      >
                        <!-- Icono editar -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                          <path
                            d="M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32l8.4-8.4Z"
                          />
                          <path
                            d="M5.25 5.25a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V13.5a.75.75 0 0 0-1.5 0v5.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V8.25a1.5 1.5 0 0 1 1.5-1.5h5.25a.75.75 0 0 0 0-1.5H5.25Z"
                          />
                        </svg>
                      </button>

                      <button
                        class="text-red-600 hover:text-red-800 transition"
                        (click)="eliminarTutoria(info)"
                      >
                        <!-- Icono eliminar -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                          <path
                            fill-rule="evenodd"
                            d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            } @else {
              <tr>
                <td colspan="6" class="py-6 px-4 text-gray-500 text-theme-sm dark:text-gray-400">
                  No se encontraron registros.
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- modal (CORRECTO) -->
<app-agregar-tutoria-modal
  [visible]="mostrarModal"
  [carrerasDisponibles]="carreras"
  [tutoresDisponibles]="tutores"
  [tutoriasEditar]="tutoriasEditar"
  (save)="guardarTutoria($event)"
  (close)="mostrarModal = false"
/>
