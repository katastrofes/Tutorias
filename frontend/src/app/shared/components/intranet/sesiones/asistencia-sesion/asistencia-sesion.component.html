<div class="fixed inset-0 bg-[#00000080] flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl overflow-hidden flex flex-col" style="height: 75vh;">

    <div class="bg-[#355085] px-6 py-4 text-white">
      <h1 class="text-2xl font-extrabold text-center">Listado de Asistencia</h1>
    </div>

    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex-shrink-0">
      <div class="flex items-center gap-4">
        
        <div class="relative w-48">
          <input
            type="text"
            placeholder="Buscar por RUT..."
            (input)="filtrarPorRut($event)"
            class="w-full py-2 pl-10 pr-4 text-gray-700 bg-white border rounded-full outline-none border-gray-300 focus:border-[#355085] transition-colors"
          />
          <div class="absolute inset-y-0 left-0 flex items-center pl-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
        </div>

        <div class="relative w-[16rem] transition-all duration-300" [class.w-[20rem]]="nombreFocused">
          <input
            type="text"
            placeholder="Buscar por nombre..."
            (input)="filtrarPorNombre($event)"
            (focus)="nombreFocused = true"
            (blur)="nombreFocused = false"
            class="w-full py-2 pl-10 pr-4 text-gray-700 bg-white border rounded-full outline-none border-gray-300 transition-all focus:border-[#355085]"
          />
          <div class="absolute inset-y-0 left-0 flex items-center pl-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 transition-colors duration-300" 
                 [class.text-[#355085]]="nombreFocused" 
                 [class.text-gray-400]="!nombreFocused" 
                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
        </div>

        <button
          *ngIf="filtroRut || filtroNombre"
          (click)="limpiarFiltros()"
          class="px-3 py-2 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"
        >
          Limpiar filtros
        </button>

      </div>
      
      <div class="mt-2 text-sm text-gray-500">
        <span *ngIf="filtroRut || filtroNombre">
          Mostrando {{ estudiantesFiltrados.length }} de {{ estudiantesTotales.length }} estudiantes
        </span>
        <span *ngIf="!(filtroRut || filtroNombre)">
          Total: {{ estudiantesTotales.length }} estudiantes
        </span>
      </div>
    </div>

    <div class="flex justify-between items-center px-6 py-3 font-semibold text-[#1E293B] border-b border-gray-200 flex-shrink-0">
      <div class="flex items-center gap-6 text-sm">
        <div class="whitespace-nowrap">Presentes: <span class="text-blue-600">{{ presentes }}</span></div>
        <div class="whitespace-nowrap">Porcentaje: <span class="text-blue-600">{{ porcentaje }}%</span></div>
      </div>
      
      <button
        (click)="toggleMarcarTodos()"
        class="px-4 py-2 bg-[#355085] hover:bg-[#2c446d] text-white rounded-md text-sm font-medium transition-colors flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path *ngIf="!todosMarcados" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          <path *ngIf="todosMarcados" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        {{ todosMarcados ? 'Desmarcar Todos' : 'Marcar Todos' }}
      </button>
    </div>

    <div class="flex-1 overflow-hidden">
      <div class="h-full overflow-y-auto px-6">
        <table class="w-full border border-gray-300 text-sm">
          <thead class="bg-[#E2E8F0] sticky top-0 z-10">
            <tr>
              <th class="px-4 py-3 text-left">Nro.</th>
              <th class="px-4 py-3 text-left">Estudiante</th>
              <th class="px-4 py-3 text-left">RUT</th>
              <th class="px-4 py-3 text-center">Asistencia</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let est of estudiantesFiltrados; let i = index"
              [ngClass]="{ 'bg-[#F1F5F9]': i % 2 === 1 }"
            >
              <td class="px-4 py-3">{{ i + 1 }}</td>
              <td class="px-4 py-3">{{ est.nombre }}</td>
              <td class="px-4 py-3">{{ est.rut }}</td>

              <td class="px-4 py-3 text-center">
                <input
                  type="checkbox"
                  class="w-5 h-5"
                  [checked]="est.presente"
                  (change)="toggleAsistencia(est)"
                />
              </td>
            </tr>
            
            <tr *ngIf="estudiantesFiltrados.length === 0">
              <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                No se encontraron estudiantes con los criterios de b√∫squeda
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="px-6 py-4 bg-gray-100 border-t border-gray-200 flex-shrink-0">
      <div class="flex justify-end gap-4">
        <button class="px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400"
                (click)="cancelar()">
          Cancelar
        </button>

        <button class="px-4 py-2 bg-[#355085] hover:bg-[#2c446d] text-white rounded-md"
                (click)="guardar()">
          Guardar
        </button>
      </div>
    </div>

  </div>
</div>